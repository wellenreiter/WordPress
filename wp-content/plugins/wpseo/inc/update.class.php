<?php class wpSEO_Update{public static function init(){if(!wpSEO::has_cap('update_plugins')){return false;}if(wpSEO_Feedback::get('critical')or wpSEO_License::expired()){return false;}add_filter('plugins_api', array(__CLASS__, 'info'), 10, 3); add_filter('site_transient_update_plugins', array(__CLASS__, 'update'));}public static function info($data, $action=null, $args=null){if($action !='plugin_information' or empty($args->slug)or $args->slug !='wpseo'){return $data;}return self::_prepare(self::_transient(), 'info');}public static function update($data){$plugin=get_plugin_data(WPSEO_FILE); $remote=self::_transient(); if(!empty($remote->version)&& version_compare($remote->version, $plugin['Version'], '>')){$data->response[WPSEO_BASE]=self::_prepare($remote, 'update');}return $data;}private static function _response(){$url=get_bloginfo('url'); $response=wpSEO_Base::get_file(sprintf(strrev('nosj.etadpu/s%/nosj/3v/nigulp/ed.oespw.ndc//:ptth'), wpSEO_Base::get_lang(true))); if(is_wp_error($response)){return -1;}$json=json_decode($response); if(is_object($json)){return $json;}return -1;}private static function _transient(){if(!$data=get_site_transient('wpseo_update')){$data=self::_response(); set_site_transient('wpseo_update', $data, 60*60*24);}return $data;}private static function _prepare($remote, $type='info'){$data=new StdClass; switch($type){case 'info': $data->name='wpSEO'; $data->slug='wpseo'; $data->author='<a href="http://eBiene.de" target="_blank">Sergej MÃ¼ller</a>'; $data->tested=esc_attr($remote->tested); $data->version=esc_attr($remote->version); $data->requires=esc_attr($remote->requires); $data->sections=get_object_vars($remote->sections); $data->homepage='http://wpseo.de'; $data->last_updated=esc_attr($remote->last_updated); $data->download_link=esc_url($remote->download_url); $data->upgrade_notice=esc_attr($remote->upgrade_notice); $data->rating=''; $data->downloaded=''; $data->num_ratings=''; break; default: $data->id=0; $data->url='http://wpseo.de'; $data->slug='wpseo'; $data->package=esc_url($remote->download_url); $data->new_version=esc_attr($remote->version); $data->upgrade_notice=esc_attr($remote->upgrade_notice); break;}return $data;}}