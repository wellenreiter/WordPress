<?php class wpSEO_Dashboard{public static function init(){if(!current_user_can('administrator')or wpSEO_Feedback::get('critical')){return false;}wp_add_dashboard_widget('wpseo_misc_monitor', 'SEO Monitor', array(__CLASS__, 'front'), array(__CLASS__, 'control')); add_action('admin_head', array(__CLASS__, 'style')); self::actions();}public static function actions(){$options=self::_options(); if($options['google']){add_action('wpseo_google_rank', array(__CLASS__, 'the_google_pagerank'));}if($options['alexa']){add_action('wpseo_alexa_rank', array(__CLASS__, 'the_alexa_rank'));}if($options['sistrix']){add_action('wpseo_sistrix_index', array(__CLASS__, 'the_sistrix_visindex'));}if($options['xovi']){add_action('wpseo_xovi_ovi', array(__CLASS__, 'the_xovi_ovi'));}if($options['seitwert']){add_action('wpseo_seit_wert', array(__CLASS__, 'the_seit_wert'));}if($options['pagespeed']){add_action('wpseo_page_speed', array(__CLASS__, 'the_page_speed'));}if($options['feed']){add_action('wpseo_feed_count', array(__CLASS__, 'the_feedburner_subscribers'));}if($options['twitter']){add_action('wpseo_twitter_count', array(__CLASS__, 'the_twitter_follower'));}}public static function style(){wp_register_style('wpseo', wpSEO::plugin_url('css/dashboard.css')); wp_print_styles('wpseo');}public static function front(){$styles=array('first b', 't', 'last b', 't'); $fields=array(); $counter=-1; $blogurl=array(); $blogurl['original']=get_bloginfo('url'); $blogurl['encoded']=urlencode($blogurl['original']); $blogurl['googled']=str_replace(array('_', '%'), array('__', '_'), $blogurl['encoded']); $blogurl['without']=wpSEO_Base::get_host($blogurl['original']); $options=self::_options(); if($options['google']){$fields[]=array('hook'=> 'wpseo_google_rank', 'name'=> 'Google Page Rank', 'link'=> esc_html__('http://www.google.com', 'wpseo'). '/search?q=site%3A' .$blogurl['encoded']);}if($options['alexa']){$fields[]=array('hook'=> 'wpseo_alexa_rank', 'name'=> 'Alexa Rank', 'link'=> 'http://www.alexa.com/siteinfo/' .$blogurl['without']);}if($options['sistrix']){$fields[]=array('hook'=> 'wpseo_sistrix_index', 'name'=> 'SISTRIX Index', 'link'=> 'http://www.sichtbarkeitsindex.de/' .$blogurl['without']);}if($options['xovi']){$fields[]=array('hook'=> 'wpseo_xovi_ovi', 'name'=> 'Xovi OVI', 'link'=> 'http://www.xovi.de/xovi-tool/ovi/');}if($options['seitwert']){$fields[]=array('hook'=> 'wpseo_seit_wert', 'name'=> 'Seitwert', 'link'=> 'http://www.seitwert.de/?url=' .$blogurl['without']);}if($options['pagespeed']){$fields[]=array('hook'=> 'wpseo_page_speed', 'name'=> 'Google Page Speed', 'link'=> 'https://developers.google.com/pagespeed/#url=' .$blogurl['googled']. '&mobile=false');}if($options['feed']){$fields[]=array('hook'=> 'wpseo_feed_count', 'name'=> 'Feedburner', 'link'=> 'http://feedburner.google.com/fb/a/myfeeds');}if($options['twitter']){$fields[]=array('hook'=> 'wpseo_twitter_count', 'name'=> 'Follower', 'link'=> 'http://twitter.com/' .$options['twitter_id']);}$fields=(array)apply_filters('wpseo_set_monitor', $fields); ?>  		<div class="table">			<table>				<?php for($a=0; $a < round(count($fields)/ 2); $a ++){$c=0; ?>					<tr class="<?php echo($a==0 ? 'first' : '')?>">						<?php for($b=0; $b < 2; $b ++){$counter ++; if($current=@$fields[$counter]){?>								<td class="<?php echo $styles[$c ++] ?>"><a href="<?php echo esc_url($current['link'], '', 'display')?>" target="_blank"><?php do_action($current['hook'])?></a></td>								<td class="<?php echo $styles[$c ++] ?>"><a href="<?php echo esc_url($current['link'], '', 'display')?>" target="_blank"><?php esc_attr_e($current['name'])?></a></td>							<?php }else{?>								<td class="last b"></td>								<td class="t"></td>							<?php }}?>					</tr>				<?php }?>			</table>		</div>	<?php }public static function control(){if(!empty($_POST['monitor_options'])){wpSEO::check_security(); $options=self::_options(); $incoming=(array)$_POST['monitor_options']; $outgoing=array('feed_id'=>(string)preg_replace('/[^a-z0-9]/i', '', sanitize_text_field($incoming['feed_id'])), 'twitter_id'=>(string)preg_replace('/[^a-z0-9_]/i', '', sanitize_text_field($incoming['twitter_id'])), 'seitwert_key'=>(string)preg_replace('/[^a-z0-9]/i', '', sanitize_text_field($incoming['seitwert_key'])), 'pagespeed_key'=>(string)preg_replace('/[^a-z0-9-_]/i', '', sanitize_text_field($incoming['pagespeed_key'])),); $outgoing=array_merge($outgoing, array('google'=>(int)(!empty($incoming['google'])), 'alexa'=>(int)(!empty($incoming['alexa'])), 'sistrix'=>(int)(!empty($incoming['sistrix'])), 'xovi'=>(int)(!empty($incoming['xovi'])), 'feed'=>(int)(!(empty($incoming['feed'])|| empty($outgoing['feed_id']))), 'twitter'=>(int)(!(empty($incoming['twitter'])|| empty($outgoing['twitter_id']))), 'seitwert'=>(int)(!(empty($incoming['seitwert'])|| empty($outgoing['seitwert_key']))), 'pagespeed'=>(int)(!(empty($incoming['pagespeed'])|| empty($outgoing['pagespeed_key']))))); $transients=array(); if($options['seitwert_key'] !=$outgoing['seitwert_key']){$transients[]='seitwert_count';}if($options['pagespeed_key'] !=$outgoing['pagespeed_key']){$transients[]='pagespeed_score';}if($options['feed_id'] !=$outgoing['feed_id']){$transients[]='feed_count';}if($options['twitter_id'] !=$outgoing['twitter_id']){$transients[]='twitter_count';}if(!empty($transients)){wpSEO_Transients::delete($transients);}wpSEO_Options::update(array('monitor_options'=> $outgoing));}$options=self::_options(); wp_nonce_field('_wpseo_nonce'); ?>						<table class="form-table">			<tr>				<td valign="top">					<table>						<tr>							<td>								<input type="checkbox" id="monitor_options_google" name="monitor_options[google]" value="1" <?php checked($options['google'], 1)?> />								<label for="monitor_options_google">Google PageRank</label>							</td>						</tr>						<tr>							<td>								<input type="checkbox" id="monitor_options_alexa" name="monitor_options[alexa]" value="1" <?php checked($options['alexa'], 1)?> />								<label for="monitor_options_alexa">Alexa Rank</label>							</td>						</tr>						<tr>							<td>								<input type="checkbox" id="monitor_options_sistrix" name="monitor_options[sistrix]" value="1" <?php checked($options['sistrix'], 1)?> />								<label for="monitor_options_sistrix">SISTRIX Index</label>							</td>						</tr>						<tr>							<td>								<input type="checkbox" id="monitor_options_xovi" name="monitor_options[xovi]" value="1" <?php checked($options['xovi'], 1)?> />								<label for="monitor_options_xovi">Xovi OVI</label>							</td>						</tr>					</table>				</td>								<td valign="top">					<table>						<tr>							<td>								<input type="checkbox" id="monitor_options_pagespeed" name="monitor_options[pagespeed]" value="1" <?php checked($options['pagespeed'], 1)?> />								<label for="monitor_options_pagespeed">Page Speed&nbsp;(API Key)</label>							</td>							<td>								<input type="text" name="monitor_options[pagespeed_key]" value="<?php echo esc_attr($options['pagespeed_key'])?>" />							</td>							<td>								<?php wpSEO::help_icon(23)?>							</td>						</tr>												<tr>							<td>								<input type="checkbox" id="monitor_options_seitwert" name="monitor_options[seitwert]" value="1" <?php checked($options['seitwert'], 1)?> />								<label for="monitor_options_seitwert">Seitwert&nbsp;(API Key)</label>							</td>							<td>								<input type="text" name="monitor_options[seitwert_key]" value="<?php echo esc_attr($options['seitwert_key'])?>" />							</td>							<td>								<?php wpSEO::help_icon(23)?>							</td>						</tr>									<tr>							<td>								<input type="checkbox" id="monitor_options_feed" name="monitor_options[feed]" value="1" <?php checked($options['feed'], 1)?> />								<label for="monitor_options_feed">Feedburner&nbsp;(ID)</label>							</td>							<td>								<input type="text" name="monitor_options[feed_id]" value="<?php echo esc_attr($options['feed_id'])?>" />							</td>							<td>								<?php wpSEO::help_icon(23)?>							</td>						</tr>									<tr>							<td>								<input type="checkbox" id="monitor_options_twitter" name="monitor_options[twitter]" value="1" <?php checked($options['twitter'], 1)?> />								<label for="monitor_options_twitter">Twitter&nbsp;(ID)</label>							</td>							<td>								<input type="text" name="monitor_options[twitter_id]" value="<?php echo esc_attr($options['twitter_id'])?>" />							</td>							<td>								<?php wpSEO::help_icon(23)?>							</td>						</tr>					</table>				</td>			</tr>		</table>	<?php }private static function _options(){return wp_parse_args(wpSEO_Options::get('monitor_options'), array('google'=> 1, 'alexa'=> 1, 'sistrix'=> 0, 'xovi'=> 0, 'seitwert'=> 0, 'seitwert_key'=> '', 'pagespeed'=> 0, 'pagespeed_key'=> '', 'feed'=> 0, 'feed_id'=> '', 'twitter'=> 0, 'twitter_id'=> ''));}public static function the_google_pagerank(){echo number_format_i18n(wpSEO_Transients::get('google_count', array(__CLASS__, 'get_google_pagerank')));}public static function get_google_pagerank(){$url=get_bloginfo('url'); $response=wpSEO_Base::get_file('http://toolbarqueries.google.com/tbr?client=navclient-auto&ch=' .self::_check_hash(self::_hash_url($url)). '&features=Rank&q=info:' .$url); if(is_wp_error($response)){return 0;}preg_match('/Rank_\d{1,2}:\d{1,2}:(\d{1,2})/',(string)$response, $matches); return(int)@$matches[1];}public static function the_alexa_rank(){echo number_format_i18n(wpSEO_Transients::get('alexa_count', array(__CLASS__, 'get_alexa_rank')));}public static function get_alexa_rank(){$response=wpSEO_Base::get_file('http://data.alexa.com/data?cli=10&dat=s&url=' .urlencode(get_bloginfo('url'))); if(is_wp_error($response)){return 0;}$xml=simplexml_load_string($response); return(int)@$xml->SD[1]->POPULARITY['TEXT'];}public static function the_sistrix_visindex(){echo wpSEO_Transients::get('sistrix_count', array(__CLASS__, 'get_sistrix_visindex'));}public static function get_sistrix_visindex(){$response=wpSEO_Base::get_file('http://api.sistrix.net/toolbar/visindex?d=' .wpSEO_Base::get_host(get_bloginfo('url'))); if(is_wp_error($response)or empty($response)or !is_numeric($response)){return 0;}return str_replace('.', ',' , $response);}public static function the_xovi_ovi(){echo wpSEO_Transients::get('xovi_count', array(__CLASS__, 'get_xovi_ovi'));}public static function get_xovi_ovi(){$response=wpSEO_Base::get_file('http://www.xovi.de/ovi_api/?domain=' .wpSEO_Base::get_host(get_bloginfo('url'))); if(is_wp_error($response)or empty($response)){return 0;}$index=str_replace(',', '.', $response); if(!is_numeric($index)){return 0;}return $response;}public static function the_seit_wert(){echo number_format_i18n(wpSEO_Transients::get('seitwert_count', array(__CLASS__, 'get_seit_wert')));}public static function get_seit_wert(){$options=wpSEO_Options::get('monitor_options'); if(empty($options['seitwert_key'])){return 0;}$response=wpSEO_Base::get_file('http://www.seitwert.de/api/getseitwert.php?url=' .wpSEO_Base::get_host(get_bloginfo('url')). '&api=' .$options['seitwert_key']); if(is_wp_error($response)){return 0;}$xml=simplexml_load_string($response); return(int)@$xml->seitwert;}public static function the_page_speed(){echo number_format_i18n(wpSEO_Transients::get('pagespeed_score', array(__CLASS__, 'get_page_speed')));}public static function get_page_speed(){$options=wpSEO_Options::get('monitor_options'); if(empty($options['pagespeed_key'])){return 0;}$response=wpSEO_Base::get_file(sprintf('https://www.googleapis.com/pagespeedonline/v1/runPagespeed?fields=score&url=%s&key=%s', urlencode(get_bloginfo('url')), $options['pagespeed_key'])); if(is_wp_error($response)){return 0;}$json=json_decode($response); return(int)@$json->score;}public static function the_feedburner_subscribers(){echo number_format_i18n(wpSEO_Transients::get('feed_count', array(__CLASS__, 'get_feedburner_subscribers')));}public static function get_feedburner_subscribers(){$options=wpSEO_Options::get('monitor_options'); if(empty($options['feed_id'])){return 0;}$response=wpSEO_Base::get_file(sprintf('https://feedburner.google.com/api/awareness/1.0/GetFeedData?id=%s', $options['feed_id'])); if(is_wp_error($response)){return 0;}$xml=simplexml_load_string($response); return(int)@$xml->feed->entry['circulation'];}public static function the_twitter_follower(){echo number_format_i18n(wpSEO_Transients::get('twitter_count', array(__CLASS__, 'get_twitter_follower')));}public static function get_twitter_follower(){$options=wpSEO_Options::get('monitor_options'); if(empty($options['twitter_id'])){return 0;}$response=wpSEO_Base::get_file('http://twitter.com/users/show/' .$options['twitter_id']); if(is_wp_error($response)){return 0;}$xml=simplexml_load_string($response); return(int)@$xml->followers_count;}protected function _convert_string($Str,$Check,$Magic){$Int32Unit=4294967296;$length=strlen($Str);for($i=0;$i<$length;$i++){$Check*=$Magic;if($Check>=$Int32Unit){$Check=($Check-$Int32Unit*(int)($Check/$Int32Unit));$Check=($Check<-2147483648)?($Check+$Int32Unit):$Check;}$Check+=ord($Str{$i});}return$Check;}protected function _hash_url($String){$Check1=self::_convert_string($String,0x1505,0x21);$Check2=self::_convert_string($String,0,0x1003F);$Check1>>=2;$Check1=(($Check1>>4)&0x3FFFFC0)|($Check1&0x3F);$Check1=(($Check1>>4)&0x3FFC00)|($Check1&0x3FF);$Check1=(($Check1>>4)&0x3C000)|($Check1&0x3FFF);$T1=(((($Check1&0x3C0)<<4)|($Check1&0x3C))<<2)|($Check2&0xF0F);$T2=(((($Check1&0xFFFFC000)<<4)|($Check1&0x3C00))<<0xA)|($Check2&0xF0F0000);return($T1|$T2);}protected function _check_hash($Hashnum){$CheckByte=0;$Flag=0;$HashStr=sprintf('%u',$Hashnum);$length=strlen($HashStr);for($i=$length-1;$i>=0;$i--){$Re=$HashStr{$i};if(1===($Flag%2)){$Re+=$Re;$Re=(int)($Re/10)+($Re%10);}$CheckByte+=$Re;$Flag++;}$CheckByte%=10;if(0!==$CheckByte){$CheckByte=10-$CheckByte;if(1===($Flag%2)){if(1===($CheckByte%2)){$CheckByte+=9;}$CheckByte>>=1;}}return'7'.$CheckByte.$HashStr;}}