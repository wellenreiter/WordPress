<?php class wpSEO_Tools{public function __construct($action){if(!in_array((string)$action, array('import', 'export'))){return false;}$callback=array($this, '_' .$action); if(is_callable($callback)){call_user_func($callback);}}private static function _import(){if(empty($_FILES['wpseo_upadd_file'])or !current_user_can('manage_options')){wp_die(__('Cheatin&#8217; uh?'));}$data=$_FILES['wpseo_upadd_file']; if(empty($data['type'])or $data['type'] !='text/xml' or !empty($data['error'])or empty($data['size'])or empty($data['tmp_name'])){wp_die(__('Cheatin&#8217; uh?'));}if(!$xml=(array)simplexml_load_file($data['tmp_name'], null, LIBXML_NOCDATA)or empty($xml['options'])){wp_die(__('Cheatin&#8217; uh?'));}$data=(array)$xml['options']; $fields=array_keys(wpSEO_Options::defaults()); $options=array(); foreach($fields as $field){if(isset($data[$field])){$item=(array)$data[$field]; $options[$field]=empty($item['item'])? @$item[0] :(array)$item['item'];}}if(empty($options)){wp_die(__('Cheatin&#8217; uh?'));}wpSEO_Options::update($options); $GLOBALS['wpdb']->query("OPTIMIZE TABLE `" .$GLOBALS['wpdb']->options. "`");}private static function _export(){if(!current_user_can('manage_options')){wp_die(__('Cheatin&#8217; uh?'));}$charset=get_bloginfo('charset'); $xml='<?xml version="1.0" encoding="' .$charset. '"?>'; $xml .="\n<root>"; $xml .="\n<options>\n"; $options=wpSEO_Options::get(); $fields=array_keys(wpSEO_Options::defaults()); foreach($fields as $field){if(in_array($field, array('monitor_options'))){continue;}$value=$options[$field]; $xml .="  <" .$field. ">"; if(is_numeric($value)){$xml .=$value;}else if(is_array($value)){$xml .="\n"; foreach($value as $sub_key=> $sub_value){$xml .="    <item>" .$sub_value. "</item>\n";}$xml .="  ";}else{$xml .="<![CDATA[" .(seems_utf8($value)? $value : utf8_encode($value)). "]]>";}$xml .="</" .$field. ">\n";}$xml .="</options>\n"; $xml .='</root>'; @ob_end_clean(); nocache_headers(); header('Content-Description: File Transfer'); header('Content-Disposition: attachment; filename=wpSEO-' .date_i18n('d.m.Y'). '.xml'); header('Content-Length: ' .strlen($xml)); header('Content-type: text/xml; charset=' .$charset, true); echo $xml; die();}}