<?php class wpSEO{public static function init(){if(wpSEO_License::expired()){return;}add_filter('the_content', array(__CLASS__, 'prepare_content')); add_action('template_redirect', array('wpSEO_Output', 'prepare_redirect'), 1); add_action('wpseo_the_meta', array('wpSEO_Output', 'the_output')); add_action('wpseo_the_title', array('wpSEO_Output', 'the_title')); add_action('wpseo_the_desc', array('wpSEO_Output', 'the_description')); add_action('wpseo_the_keys', array('wpSEO_Output', 'the_keywords')); add_action('wpseo_the_robots', array('wpSEO_Output', 'the_robots')); add_action('wpseo_the_canonical', array('wpSEO_Output', 'the_canonical')); add_filter('wpseo_set_meta', array(__CLASS__, 'set_meta')); $options=wpSEO_Options::get(); if($options['misc_monitor'] && $options['misc_monitor_theme']){require_once WPSEO_DIR. '/inc/dashboard.class.php'; wpSEO_Dashboard::actions();}if($options['key_button']){add_shortcode('wpseo', create_function('$a, $b', 'return $b;'));}}public function prepare_content($input){if(is_404()or is_feed()or is_trackback()or is_attachment()or is_robots()or self::is_mobile()){return $input;}$output=trim($input); if(empty($output)){return;}$options=wpSEO_Options::get(); if(is_singular()){if($options['misc_nextpage']){$output=preg_replace('#<!--nextpage(title|desc|keys):(?:.*?)-->(?:<br />)?\n#uis', '', $output);}if($options['misc_section']){$output=sprintf("\n<!-- google_ad_section_start -->\n%s\n<!-- google_ad_section_end -->\n", $output);}}return $output;}public function is_mobile(){return strpos(TEMPLATEPATH, 'wptouch');}public static function set_meta($input){if(empty($input)or !is_array($input)){return;}$meta=wp_cache_get('wpseo_meta'); foreach($input as $key=> $value){if(in_array($key, wpSEO_Vars::get('custom_meta'))){if($key=='canonical'){$meta[$key]=esc_url_raw($value);}else{$meta[$key]=sanitize_text_field($value); $meta[$key]=trim($meta[$key], ', ');}}}if(empty($meta)){return;}wp_cache_set('wpseo_meta', $meta);}}require_once WPSEO_DIR. '/inc/license.class.php'; require_once WPSEO_DIR. '/inc/transients.class.php'; require_once WPSEO_DIR. '/inc/options.class.php'; require_once WPSEO_DIR. '/inc/base.class.php'; require_once WPSEO_DIR. '/inc/vars.class.php'; require_once WPSEO_DIR. '/inc/output.class.php';